package advent

import (
	"fmt"
	"strings"
	"testing"

	"github.com/stretchr/testify/assert"
)

func Day11(input string) (int, int) {
	tot := 0
	tot2 := 0
	//input = Day11_Expand(input)
	expCols := map[int]bool{}
	expRows := map[int]bool{}
	lines := strings.Split(input, "\n")
	for i, l := range lines {
		expRows[i] = true
		for j := range l {
			expCols[j] = true
		}
	}
	for y, l := range lines {
		for x, c := range l {
			if c != '.' {
				expRows[y] = false
				expCols[x] = false
			}
		}
	}
	type point struct {
		x, y int
	}
	pts := []point{}
	for y, l := range Lines(input) {
		for x, c := range l {
			if c != '.' {
				pts = append(pts, point{x: x, y: y})
			}
		}
	}
	dist := func(y0, y1, x0, x1, step int) int {
		//fmt.Println(y0, y1, x0, x1, step)
		s := 0
		defer func() {
			//	fmt.Println(s)
		}()
		for y := y0 + 1; y <= y1; y++ {
			s++
			if expRows[y] {
				s += step
			}
		}
		//fmt.Println(s)
		if x1 == x0 {
			return s
		}
		dx := 1
		if x1 < x0 {
			dx = -1
		}
		//fmt.Println(dx)
		for x := x0 + dx; ; x += dx {
			s++
			if expCols[x] {
				s += step
			}
			if x == x1 {
				break
			}
		}
		return s
	}
	for a, pa := range pts {
		for b := a + 1; b < len(pts); b++ {
			pb := pts[b]
			tot += dist(pa.y, pb.y, pa.x, pb.x, 1)
			tot2 += dist(pa.y, pb.y, pa.x, pb.x, 999999)
		}
	}
	return tot, tot2
}

func TestDay11_Ex1(t *testing.T) {
	a, b := Day11(exD11)
	assert.Equal(t, 374, a)
	assert.Equal(t, 8410, b)
}

func TestDay11_Actual(t *testing.T) {
	a, b := Day11(inputD11)
	fmt.Printf("Day 11 Part 1: %d\n", a)
	fmt.Printf("Day 11 Part 2: %d\n", b)
}

const exD11 = `...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....`

const exD11_expand = `....#........
.........#...
#............
.............
.............
........#....
.#...........
............#
.............
.............
.........#...
#....#.......`

const inputD11 = `................................#.......#......#.....#...........................#..........................................................
..........................................................#..........................................................#...........#..........
.....#.....................#.............................................................#..................................................
.............#..............................................................................................................................
.....................................................................................#....................#.................#...............
..................#..........................................#...................................#..............#...........................
...............................#....................................................................................................#.......
..........#..............#.............#................#...................#...............................................................
....#............................................................................#..........................................................
...............#................................#......................................................................#................#...
...................................#.............................#...............................................#..........#.....#.........
#...................................................................................#.....#.....#......#....................................
...............................#............................................................................................................
..........................................................#................#................................................................
.......#.......................................................................................................................#............
..#.........#.........................................................................#.....................................................
..........................................#........#.......................................#.......#..................#............#........
.................#..............#..............................#...............................................#..........................#.
...............................................................................................#........#...................................
......................#............................................#......................................................#.................
.....................................#.....................................#..........................................................#.....
......#......................#...................#......#...................................................................................
..........................................................................................................#.................................
......................................................................#.........................................#.............#.............
#............................................#.........................................#.................................................#..
.............................................................#.....................................#........................................
..............#..............................................................................................#....................#.........
.........#.........#...................................#....................................................................................
........................................#..............................#........................#......#.................#..................
......................................................................................#................................................#....
................#...........#...............................................................................................................
.....................................................#.........#............................................................................
....#.......#.......#.......................................................#.....................#.........................................
.....................................#...........#..............................................................#...........................
..........................................................................................................#.................................
.......................#.............................................#..........#...........................................................
#............................................................#...........................#.................................#.......#........
.............................#......................................................#.................................#.....................
.........................................#............#.................#......................#..............#................#.........#..
............................................................................................................................................
..........#.................................................................................................................................
..........................................................#.......................................#.........................................
#.....................#...............#..........#....................#.................................#...................#...............
............................................................................................................................................
.......#..........................#.........................................................................................................
.................#...............................................#..............................#.................................#.........
........................................................................................................................#...................
..............................#.................#.....#..............................#..........................#...........................
.....................................#.........................................#...........................#.........................#......
.............#.....................................................#............................................................#..........#
....#.........................................................#..................................#..........................................
............................................#...........................#..................................................#................
...............................#.........................................................................#..................................
............................................................................................................................................
.................#.........#....................#..........................#........................................................#.......
.......................................................#....................................#...............................................
............................................................................................................................................
...#...............................................................................#............................................#...........
..........#.....................#......................................................................#....................................
.........................................#..................................................................................................
.....................................................#.................#.............................................#..............#.......
......................#.......................#.............................................................................#...............
........#.............................#..........................#....................#.......................#.............................
.................#..........................................................................#.....#.............................#.........#.
............................................................................................................................................
.........................................................................#..................................................................
..............................................................#.............................................................................
..........................#.............#..........................#.......................................#..........#.....................
............................................................................................................................................
..............................#......................................................................#............#...............#.........
.............#..............................#.........#.................#...................................................................
.....................#............................................................#.......................................#.................
......................................#................................................#.................................................#..
.................#...............................#..........................................................#...............................
........#......................................................#...........#................................................................
.........................................#......................................#...........#.....................#.........................
.#.........................#................................................................................................................
................................................................................................#...................................#......#
...........................................................#............#.............#..................#..................................
..................................................#.........................................................................................
...........#................................#......................#................................................#..........#............
........................#.........#.........................................................................................................
.............................................................#.................................#...............#...........#................
................#............#.......................................................................#......................................
.#......................................................................#......#...........#................................................
........................................................#..................................................#................................
......................#...................#.....#..................#..............................#.........................................
............................................................................................................................................
...........#..........................#....................#............................................................#...................
...................#...................................................................#...............................................#....
...........................#...................................................................#.........#..................................
.....#...........................................#.........................................................................#................
......................#.............#......................................#......#.................#.......................................
...............#..............#...........................................................#.....................#...............#...........
...........................................................#.....#.........................................................................#
.......................................#...............................#....................................................................
.................................#..................#..................................................................................#....
...........................................#..................................#.........................#...................................
.........#..............................................................................#...................................................
................#.....#................................#.................................................................#..................
.................................................................................................#..........................................
#..............................................#........................#...........................................#................#......
..............................#...................................................#.......................#.................................
..................#.................................#......................................................................................#
..........#................................#..................................#...........#.................................................
.....................................................................#....................................................#.................
...............#.....................................................................................................#......................
#........................................................#......#..........................................#........................#.......
.......................#.........#......#...................................................................................................
.....#......................................................................................................................................
..................#...............................#....................................................................#....................
............................................#......................#........................................................................
.............#........................................#.........................#.........#........................#.....................#..
...................................................................................................#..............................#.........
..........................#.................................................................................................................
..#................#....................................................#.......................................#...........................
...........#.................................#.........................................#................................#.............#.....
......................................#.......................#.....#.....................................#.................................
.................................#...............................................................#..........................................
.................#..........#.............................................#.......#...............................#..........#..............
.......................................................#................................................................................#...
..#........................................................................................#................................................
............................................................................................................................................
...................................#..........................................#.............................................................
...........................................#........#...............................................#...........................#...........
................................................................#......#....................................................................
....#.................#.........................#...............................................................#...........................
............................#..............................................................................#................#.......#.......
........#................................#................#.............................#............................#......................
#....................................................#..................................................................................#...
............#........................................................#........................#.............................................
..................#................#.......................................#................................................................
...........................#...............#......#..........#..................#..................#.................................#.....#
..........................................................................................#......................#.........#................
.......................................#....................................................................#...............................
...............#..............#........................................#................................................................#...
..........#.................................................................#...............................................................
.....#...............................................#.....#.....................................#..................#.........#.............
...............................................#........................................................#...................................
.#....................#.............................................................#.................................................#.....`
